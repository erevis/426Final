<div id="login">
    Username: <input id="inputUser" type="text"> </input> <br>
    Password: <input id="inputPass" type = text> </input>
    <button id="signIn"> Sign In </button>
    <button id="signUp"> Sign Up </button>
</div> 

<div id="game" style="display:none">
    <canvas id ="canv" width="500" height ="500" style="border:1px solid #000000; cursor: none"></canvas>

    <div id="chatText" style="width:500px;height:100px;overflow-y:scroll;">  </div>
    <form id = "chatForm">
        <input id="chatInput" type="text" style="width:500px"></input> 
    </form>  
</div>

<script src= "https://cdn.socket.io/socket.io-1.4.5.js">
</script>

<script>
    var socket = io();
    

    // The Sign-In Page Elements
    let login = document.getElementById("login")
    let game = document.getElementById("game")
    let user = document.getElementById("inputUser")
    let pass = document.getElementById("inputPass")  
    let signIn = document.getElementById("signIn")
    let signUp = document.getElementById("signUp")
    
    //Send Username and Password to the Server for signing up and signing in
    signIn.onclick = function(){
        socket.emit('signIn', {Usr:user.value, Pas:pass.value})
    }
    signUp.onclick = function(e){
        socket.emit('signUp', {Usr:user.value, Pas:pass.value})
    }

    // If the user and pass are correct then show game page, else do nothing
    socket.on('signInRes', function(data) {
        if (data.result) {
            login.style.display = "none"
            game.style.display = "inline-block"
        }
    })
    socket.on('signUpRes', function(data){
        if (data.result){
            login.style.display = "none"
            game.style.display = "inline-block"
        }
    })
    
    // Game Page Elements
    var canv = document.getElementById("canv").getContext("2d")
    canv.font = '20px Arial'
    let chatText = document.getElementById("chatText")
    let chatInput = document.getElementById("chatInput")
    let chatForm = document.getElementById("chatForm")
    
    //When the server tells the client to add message, client adds to the chat and and clears the chat box
    socket.on('addToChat', function(data){
        chatInput.value = ""
        chatText.innerHTML += '<div>' + data + '</div>'
    })
    // Used to print out for debugging 
    socket.on('evalAns', function(data){
        console.log(data)
    }) 
    // Start chat messages with '.' to evalate something. Ex: .Users would result in printing the Users online
    chatForm.onsubmit = function(event) {
        event.preventDefault()
        if (chatInput.value[0] === '.') {
            socket.emit('evalServ', chatInput.value.slice(1))
        } else {
            socket.emit('msgServ', chatInput.value)
        }
    }
    //When the server sends new positions to the client, it will repaint the canvas with new positions
    socket.on('newPostions', function(data){
        canv.clearRect(0,0,500,500)
        for (var i = 0; i < data.length;i++){
            canv.fillText(data[i].name, data[i].x, data[i].y)
        }
    })

    //Tell server when someone presses WASD
    document.onkeydown = function(event){
        if (event.keyCode == 68) { 
            socket.emit('keyPress', {InputId:'right', state:true})
        }
        if (event.keyCode == 87) { 
            socket.emit('keyPress', {InputId:'down', state:true})
        }
        if (event.keyCode == 65) { 
            socket.emit('keyPress', {InputId:'left', state:true})
        }
        if (event.keyCode == 83) { 
            socket.emit('keyPress', {InputId:'up', state:true})
        }
    }
    document.onkeyup = function(event){
        if (event.keyCode == 68) { 
            socket.emit('keyPress', {InputId:'right', state:false})
        }
        if (event.keyCode == 87) { 
            socket.emit('keyPress', {InputId:'down', state:false})
        }
        if (event.keyCode == 65) { 
            socket.emit('keyPress', {InputId:'left', state:false})
        }
        if (event.keyCode == 83) { 
            socket.emit('keyPress', {InputId:'up', state:false})
        }
    }
</script>